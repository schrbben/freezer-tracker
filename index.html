<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fryserboks - Ruben, Wikse & Fosse</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Supabase config - Ferdig satt opp og klar!
        const SUPABASE_URL = 'https://ztxvmojqzqkjwfxsyqyx.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0eHZtb2pxenFrand

meHN5cXl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzg5NTgxOTMsImV4cCI6MjA1NDUzNDE5M30.vRO_hXKvXEPQ0DqvAwAHx4UuwxPpFbPDp3tOB3x1aQM';

        // Icons (samme som fÃ¸r)
        const Search = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>;
        const Plus = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const Trash2 = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
        const Calendar = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const Package = ({ className = "w-5 h-5" }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>;
        const User = ({ className = "w-4 h-4" }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const Trophy = ({ className = "w-5 h-5" }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;

        function FreezerTracker() {
            const [items, setItems] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [newItem, setNewItem] = useState({ name: '', quantity: '', category: 'other', addedBy: 'Ruben' });
            const [isLoading, setIsLoading] = useState(true);
            const [showAddForm, setShowAddForm] = useState(false);
            const [sortBy, setSortBy] = useState('newest');
            const [filterCategory, setFilterCategory] = useState('all');
            const [isSyncing, setIsSyncing] = useState(false);

            const roommates = ['Ruben', 'Wikse', 'Fosse'];

            const loadItems = async () => {
                try {
                    const res = await fetch(`${SUPABASE_URL}/rest/v1/freezer_items?select=*&order=id.desc`, {
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    });
                    if (res.ok) setItems(await res.json());
                } catch (e) { console.error(e); }
                finally { setIsLoading(false); }
            };

            useEffect(() => {
                loadItems();
                const interval = setInterval(loadItems, 5000);
                return () => clearInterval(interval);
            }, []);

            const addItem = async () => {
                if (!newItem.name.trim()) return alert('Vennligst skriv inn navnet pÃ¥ varen');
                setIsSyncing(true);
                try {
                    const res = await fetch(`${SUPABASE_URL}/rest/v1/freezer_items`, {
                        method: 'POST',
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json', 'Prefer': 'return=minimal' },
                        body: JSON.stringify({ name: newItem.name.trim(), quantity: newItem.quantity || '1', category: newItem.category, added_by: newItem.addedBy, date_added: new Date().toISOString().split('T')[0] })
                    });
                    if (res.ok) {
                        await loadItems();
                        setNewItem({ name: '', quantity: '', category: 'other', addedBy: newItem.addedBy });
                        setShowAddForm(false);
                    } else alert('Kunne ikke legge til vare');
                } catch (e) { alert('Feil ved lagring'); }
                finally { setIsSyncing(false); }
            };

            const deleteItem = async (id) => {
                setIsSyncing(true);
                try {
                    await fetch(`${SUPABASE_URL}/rest/v1/freezer_items?id=eq.${id}`, {
                        method: 'DELETE',
                        headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
                    });
                    await loadItems();
                } catch (e) { alert('Kunne ikke slette'); }
                finally { setIsSyncing(false); }
            };

            const categories = {
                meat: { name: 'KjÃ¸tt & Fisk', color: 'bg-red-100 text-red-800', icon: 'ðŸ¥©' },
                vegetables: { name: 'GrÃ¸nnsaker', color: 'bg-green-100 text-green-800', icon: 'ðŸ¥¦' },
                fruit: { name: 'Frukt & BÃ¦r', color: 'bg-purple-100 text-purple-800', icon: 'ðŸ“' },
                prepared: { name: 'Ferdigretter', color: 'bg-blue-100 text-blue-800', icon: 'ðŸ±' },
                dairy: { name: 'Meieri & Is', color: 'bg-yellow-100 text-yellow-800', icon: 'ðŸ§Š' },
                other: { name: 'Annet', color: 'bg-gray-100 text-gray-800', icon: 'ðŸ“¦' }
            };

            const getDaysInFreezer = (dateAdded) => Math.ceil(Math.abs(new Date() - new Date(dateAdded)) / (1000 * 60 * 60 * 24));
            const getAgeWarning = (d) => d > 90 ? { color: 'text-red-600', bg: 'bg-red-50' } : d > 60 ? { color: 'text-orange-600', bg: 'bg-orange-50' } : d > 30 ? { color: 'text-yellow-600', bg: 'bg-yellow-50' } : { color: 'text-green-600', bg: 'bg-green-50' };

            const stats = roommates.map(name => ({ name, count: items.filter(i => i.added_by === name).length })).sort((a, b) => b.count - a.count);
            
            let filteredItems = items.filter(i => i.name.toLowerCase().includes(searchTerm.toLowerCase()) && (filterCategory === 'all' || i.category === filterCategory));
            if (sortBy === 'oldest') filteredItems.sort((a, b) => new Date(a.date_added) - new Date(b.date_added));
            else if (sortBy === 'newest') filteredItems.sort((a, b) => new Date(b.date_added) - new Date(a.date_added));
            else filteredItems.sort((a, b) => a.name.localeCompare(b.name));

            if (isLoading) return <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center"><div className="text-lg text-gray-600">Laster fryserboksen...</div></div>;

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-8">
                    <div className="max-w-5xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between mb-4 flex-wrap gap-4">
                                <div className="flex items-center gap-3">
                                    <Package className="w-8 h-8 text-indigo-600" />
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-800">Fryserboks</h1>
                                        <p className="text-sm text-gray-500">Ruben, Wikse & Fosse</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2 text-xs text-green-600 bg-green-50 px-3 py-1 rounded-full">
                                    <div className={`w-2 h-2 rounded-full ${isSyncing ? 'bg-yellow-500 animate-pulse' : 'bg-green-500'}`}></div>
                                    {isSyncing ? 'Synkroniserer...' : 'Live'}
                                </div>
                            </div>
                            <div className="space-y-3">
                                <div className="relative">
                                    <div className="absolute left-3 top-3"><Search /></div>
                                    <input type="text" placeholder="SÃ¸k etter varer..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                                </div>
                                <div className="flex gap-3 flex-wrap">
                                    <select value={filterCategory} onChange={(e) => setFilterCategory(e.target.value)} className="flex-1 min-w-[150px] px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="all">Alle kategorier</option>
                                        {Object.entries(categories).map(([k, c]) => <option key={k} value={k}>{c.icon} {c.name}</option>)}
                                    </select>
                                    <select value={sortBy} onChange={(e) => setSortBy(e.target.value)} className="flex-1 min-w-[150px] px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="newest">Nyeste fÃ¸rst</option>
                                        <option value="oldest">Eldste fÃ¸rst</option>
                                        <option value="name">Alfabetisk</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            {stats.map((s, i) => (
                                <div key={s.name} className="bg-white rounded-lg shadow p-4">
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center gap-2">
                                            <User className="w-5 h-5 text-indigo-600" />
                                            <span className="font-semibold text-gray-800">{s.name}</span>
                                            {i === 0 && s.count > 0 && <Trophy className="w-4 h-4 text-yellow-500" />}
                                        </div>
                                        <span className="text-2xl font-bold text-indigo-600">{s.count}</span>
                                    </div>
                                    <p className="text-xs text-gray-500 mt-1">{s.count === 1 ? 'vare' : 'varer'} i fryseren</p>
                                </div>
                            ))}
                        </div>

                        {!showAddForm && <button onClick={() => setShowAddForm(true)} disabled={isSyncing} className="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg mb-6 flex items-center justify-center gap-2 hover:bg-indigo-700 transition-colors shadow-lg disabled:opacity-50"><Plus />Legg til vare</button>}

                        {showAddForm && (
                            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <h2 className="text-xl font-semibold mb-4 text-gray-800">Legg til ny vare</h2>
                                <div className="space-y-4">
                                    <input type="text" placeholder="Varenavn" value={newItem.name} onChange={(e) => setNewItem({ ...newItem, name: e.target.value })} onKeyPress={(e) => e.key === 'Enter' && addItem()} className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" autoFocus />
                                    <input type="text" placeholder="Mengde" value={newItem.quantity} onChange={(e) => setNewItem({ ...newItem, quantity: e.target.value })} onKeyPress={(e) => e.key === 'Enter' && addItem()} className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <select value={newItem.category} onChange={(e) => setNewItem({ ...newItem, category: e.target.value })} className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            {Object.entries(categories).map(([k, c]) => <option key={k} value={k}>{c.icon} {c.name}</option>)}
                                        </select>
                                        <select value={newItem.addedBy} onChange={(e) => setNewItem({ ...newItem, addedBy: e.target.value })} className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            {roommates.map(n => <option key={n} value={n}>{n}</option>)}
                                        </select>
                                    </div>
                                    <div className="flex gap-3">
                                        <button onClick={addItem} disabled={isSyncing} className="flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 disabled:opacity-50">{isSyncing ? 'Lagrer...' : 'Legg til'}</button>
                                        <button onClick={() => { setShowAddForm(false); setNewItem({ ...newItem, name: '', quantity: '' }); }} className="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300">Avbryt</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="bg-white rounded-lg shadow-lg overflow-hidden">
                            {filteredItems.length === 0 ? (
                                <div className="p-12 text-center">
                                    <Package className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                    <p className="text-gray-500 text-lg">{searchTerm || filterCategory !== 'all' ? 'Ingen varer funnet' : 'Fryseren er tom. Legg til noen varer!'}</p>
                                </div>
                            ) : (
                                <div className="divide-y divide-gray-100">
                                    {filteredItems.map((item) => {
                                        const days = getDaysInFreezer(item.date_added);
                                        const age = getAgeWarning(days);
                                        return (
                                            <div key={item.id} className="p-4 hover:bg-gray-50">
                                                <div className="flex items-start justify-between gap-3">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-2 mb-2 flex-wrap">
                                                            <h3 className="text-lg font-semibold text-gray-800">{item.name}</h3>
                                                            <span className={`text-xs px-2 py-1 rounded-full ${categories[item.category].color}`}>{categories[item.category].icon} {categories[item.category].name}</span>
                                                            <span className={`text-xs px-2 py-1 rounded-full ${age.bg} ${age.color} font-medium`}>{days} {days === 1 ? 'dag' : 'dager'} gammel</span>
                                                        </div>
                                                        <div className="flex items-center gap-4 text-sm text-gray-600 flex-wrap">
                                                            <span className="flex items-center gap-1"><Package className="w-4 h-4" />{item.quantity}</span>
                                                            <span className="flex items-center gap-1"><User className="w-4 h-4" />{item.added_by}</span>
                                                            <span className="flex items-center gap-1"><Calendar />{item.date_added}</span>
                                                        </div>
                                                    </div>
                                                    <button onClick={() => confirm(`Fjerne "${item.name}"?`) && deleteItem(item.id)} disabled={isSyncing} className="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg disabled:opacity-50"><Trash2 /></button>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>

                        {items.length > 0 && (
                            <div className="mt-6 bg-white rounded-lg shadow p-6">
                                <h3 className="font-semibold text-gray-800 mb-3">Oppsummering</h3>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                    <div><div className="text-2xl font-bold text-indigo-600">{items.length}</div><div className="text-xs text-gray-500">Totalt</div></div>
                                    <div><div className="text-2xl font-bold text-green-600">{items.filter(i => getDaysInFreezer(i.date_added) <= 30).length}</div><div className="text-xs text-gray-500">Ferske</div></div>
                                    <div><div className="text-2xl font-bold text-orange-600">{items.filter(i => getDaysInFreezer(i.date_added) > 60).length}</div><div className="text-xs text-gray-500">Gamle</div></div>
                                    <div><div className="text-2xl font-bold text-purple-600">{stats[0]?.name || '-'}</div><div className="text-xs text-gray-500">Topp</div></div>
                                </div>
                            </div>
                        )}

                        <div className="mt-6 text-center text-xs text-gray-500 bg-white rounded-lg shadow p-3">
                            <p>ðŸ”„ Oppdateres automatisk hvert 5. sekund - alle ser samme innhold!</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<FreezerTracker />);
    </script>
</body>
</html>
