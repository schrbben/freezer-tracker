<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freezer Tracker - Ruben, Wikse & Fosse</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Search = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const Plus = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Calendar = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const Package = ({ className = "w-5 h-5" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                <line x1="12" y1="22.08" x2="12" y2="12"></line>
            </svg>
        );

        const User = ({ className = "w-4 h-4" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const Clock = ({ className = "w-4 h-4" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const Trophy = ({ className = "w-5 h-5" }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                <path d="M4 22h16"></path>
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
            </svg>
        );

        function FreezerTracker() {
            const [items, setItems] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [newItem, setNewItem] = useState({ name: '', quantity: '', category: 'other', addedBy: 'Ruben' });
            const [isLoading, setIsLoading] = useState(true);
            const [showAddForm, setShowAddForm] = useState(false);
            const [sortBy, setSortBy] = useState('newest');
            const [filterCategory, setFilterCategory] = useState('all');

            const roommates = ['Ruben', 'Wikse', 'Fosse'];

            useEffect(() => {
                loadItems();
            }, []);

            const loadItems = async () => {
                try {
                    const result = await window.storage.get('freezer-items-v2', true);
                    if (result && result.value) {
                        setItems(JSON.parse(result.value));
                    }
                } catch (error) {
                    console.log('No existing items found');
                } finally {
                    setIsLoading(false);
                }
            };

            const saveItems = async (updatedItems) => {
                try {
                    await window.storage.set('freezer-items-v2', JSON.stringify(updatedItems), true);
                    setItems(updatedItems);
                } catch (error) {
                    console.error('Failed to save items:', error);
                    alert('Failed to save. Please try again.');
                }
            };

            const addItem = async () => {
                if (!newItem.name.trim()) {
                    alert('Please enter an item name');
                    return;
                }

                const item = {
                    id: Date.now().toString(),
                    name: newItem.name.trim(),
                    quantity: newItem.quantity || '1',
                    category: newItem.category,
                    addedBy: newItem.addedBy,
                    dateAdded: new Date().toISOString().split('T')[0]
                };

                await saveItems([...items, item]);
                setNewItem({ name: '', quantity: '', category: 'other', addedBy: newItem.addedBy });
                setShowAddForm(false);
            };

            const deleteItem = async (id) => {
                const updatedItems = items.filter(item => item.id !== id);
                await saveItems(updatedItems);
            };

            const categories = {
                meat: { name: 'Meat & Seafood', color: 'bg-red-100 text-red-800', icon: 'ðŸ¥©' },
                vegetables: { name: 'Vegetables', color: 'bg-green-100 text-green-800', icon: 'ðŸ¥¦' },
                fruit: { name: 'Fruit', color: 'bg-purple-100 text-purple-800', icon: 'ðŸ“' },
                prepared: { name: 'Prepared Meals', color: 'bg-blue-100 text-blue-800', icon: 'ðŸ±' },
                dairy: { name: 'Dairy & Frozen', color: 'bg-yellow-100 text-yellow-800', icon: 'ðŸ§Š' },
                other: { name: 'Other', color: 'bg-gray-100 text-gray-800', icon: 'ðŸ“¦' }
            };

            const getDaysInFreezer = (dateAdded) => {
                const added = new Date(dateAdded);
                const now = new Date();
                const diffTime = Math.abs(now - added);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            };

            const getAgeWarning = (days) => {
                if (days > 90) return { color: 'text-red-600', label: 'Very old!', bg: 'bg-red-50' };
                if (days > 60) return { color: 'text-orange-600', label: 'Getting old', bg: 'bg-orange-50' };
                if (days > 30) return { color: 'text-yellow-600', label: 'Use soon', bg: 'bg-yellow-50' };
                return { color: 'text-green-600', label: 'Fresh', bg: 'bg-green-50' };
            };

            // Calculate stats
            const stats = roommates.map(name => ({
                name,
                count: items.filter(item => item.addedBy === name).length
            })).sort((a, b) => b.count - a.count);

            const topContributor = stats[0]?.name;

            // Filter and sort items
            let filteredItems = items.filter(item =>
                item.name.toLowerCase().includes(searchTerm.toLowerCase()) &&
                (filterCategory === 'all' || item.category === filterCategory)
            );

            if (sortBy === 'oldest') {
                filteredItems.sort((a, b) => new Date(a.dateAdded) - new Date(b.dateAdded));
            } else if (sortBy === 'newest') {
                filteredItems.sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));
            } else if (sortBy === 'name') {
                filteredItems.sort((a, b) => a.name.localeCompare(b.name));
            }

            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
                        <div className="text-lg text-gray-600">Loading freezer inventory...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-8">
                    <div className="max-w-5xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between mb-4 flex-wrap gap-4">
                                <div className="flex items-center gap-3">
                                    <Package className="w-8 h-8 text-indigo-600" />
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-800">Freezer Tracker</h1>
                                        <p className="text-sm text-gray-500">Ruben, Wikse & Fosse</p>
                                    </div>
                                </div>
                            </div>

                            {/* Search and Filters */}
                            <div className="space-y-3">
                                <div className="relative">
                                    <div className="absolute left-3 top-3">
                                        <Search />
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="Search items..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>
                                
                                <div className="flex gap-3 flex-wrap">
                                    <select
                                        value={filterCategory}
                                        onChange={(e) => setFilterCategory(e.target.value)}
                                        className="flex-1 min-w-[150px] px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    >
                                        <option value="all">All Categories</option>
                                        {Object.entries(categories).map(([key, cat]) => (
                                            <option key={key} value={key}>{cat.icon} {cat.name}</option>
                                        ))}
                                    </select>
                                    
                                    <select
                                        value={sortBy}
                                        onChange={(e) => setSortBy(e.target.value)}
                                        className="flex-1 min-w-[150px] px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    >
                                        <option value="newest">Newest First</option>
                                        <option value="oldest">Oldest First</option>
                                        <option value="name">Alphabetical</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        {/* Stats Dashboard */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            {stats.map((stat, index) => (
                                <div key={stat.name} className="bg-white rounded-lg shadow p-4">
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center gap-2">
                                            <User className="w-5 h-5 text-indigo-600" />
                                            <span className="font-semibold text-gray-800">{stat.name}</span>
                                            {index === 0 && stat.count > 0 && (
                                                <Trophy className="w-4 h-4 text-yellow-500" />
                                            )}
                                        </div>
                                        <span className="text-2xl font-bold text-indigo-600">{stat.count}</span>
                                    </div>
                                    <p className="text-xs text-gray-500 mt-1">
                                        {stat.count === 1 ? 'item' : 'items'} in freezer
                                    </p>
                                </div>
                            ))}
                        </div>

                        {/* Add Item Button */}
                        {!showAddForm && (
                            <button
                                onClick={() => setShowAddForm(true)}
                                className="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg mb-6 flex items-center justify-center gap-2 hover:bg-indigo-700 transition-colors shadow-lg"
                            >
                                <Plus />
                                Add Item to Freezer
                            </button>
                        )}

                        {/* Add Item Form */}
                        {showAddForm && (
                            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <h2 className="text-xl font-semibold mb-4 text-gray-800">Add New Item</h2>
                                <div className="space-y-4">
                                    <input
                                        type="text"
                                        placeholder="Item name (e.g., Ground beef, Ice cream)"
                                        value={newItem.name}
                                        onChange={(e) => setNewItem({ ...newItem, name: e.target.value })}
                                        onKeyPress={(e) => e.key === 'Enter' && addItem()}
                                        className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Quantity (e.g., 2 lbs, 1 bag)"
                                        value={newItem.quantity}
                                        onChange={(e) => setNewItem({ ...newItem, quantity: e.target.value })}
                                        onKeyPress={(e) => e.key === 'Enter' && addItem()}
                                        className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <select
                                            value={newItem.category}
                                            onChange={(e) => setNewItem({ ...newItem, category: e.target.value })}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        >
                                            {Object.entries(categories).map(([key, cat]) => (
                                                <option key={key} value={key}>{cat.icon} {cat.name}</option>
                                            ))}
                                        </select>
                                        <select
                                            value={newItem.addedBy}
                                            onChange={(e) => setNewItem({ ...newItem, addedBy: e.target.value })}
                                            className="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        >
                                            {roommates.map(name => (
                                                <option key={name} value={name}>{name}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="flex gap-3">
                                        <button
                                            onClick={addItem}
                                            className="flex-1 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors"
                                        >
                                            Add Item
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowAddForm(false);
                                                setNewItem({ ...newItem, name: '', quantity: '' });
                                            }}
                                            className="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Items List */}
                        <div className="bg-white rounded-lg shadow-lg overflow-hidden">
                            {filteredItems.length === 0 ? (
                                <div className="p-12 text-center">
                                    <Package className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                    <p className="text-gray-500 text-lg">
                                        {searchTerm || filterCategory !== 'all' ? 'No items found' : 'Your freezer is empty. Add some items!'}
                                    </p>
                                </div>
                            ) : (
                                <div className="divide-y divide-gray-100">
                                    {filteredItems.map((item) => {
                                        const daysInFreezer = getDaysInFreezer(item.dateAdded);
                                        const ageWarning = getAgeWarning(daysInFreezer);
                                        
                                        return (
                                            <div key={item.id} className="p-4 hover:bg-gray-50 transition-colors">
                                                <div className="flex items-start justify-between gap-3">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-2 mb-2 flex-wrap">
                                                            <h3 className="text-lg font-semibold text-gray-800">{item.name}</h3>
                                                            <span className={`text-xs px-2 py-1 rounded-full ${categories[item.category].color}`}>
                                                                {categories[item.category].icon} {categories[item.category].name}
                                                            </span>
                                                            <span className={`text-xs px-2 py-1 rounded-full ${ageWarning.bg} ${ageWarning.color} font-medium`}>
                                                                {daysInFreezer} days old
                                                            </span>
                                                        </div>
                                                        <div className="flex items-center gap-4 text-sm text-gray-600 flex-wrap">
                                                            <span className="flex items-center gap-1">
                                                                <Package className="w-4 h-4" />
                                                                {item.quantity}
                                                            </span>
                                                            <span className="flex items-center gap-1">
                                                                <User className="w-4 h-4" />
                                                                {item.addedBy}
                                                            </span>
                                                            <span className="flex items-center gap-1">
                                                                <Calendar />
                                                                {item.dateAdded}
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <button
                                                        onClick={() => deleteItem(item.id)}
                                                        className="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition-colors flex-shrink-0"
                                                        title="Remove item"
                                                    >
                                                        <Trash2 />
                                                    </button>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>

                        {/* Summary Stats */}
                        {items.length > 0 && (
                            <div className="mt-6 bg-white rounded-lg shadow p-6">
                                <h3 className="font-semibold text-gray-800 mb-3">Freezer Summary</h3>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                    <div>
                                        <div className="text-2xl font-bold text-indigo-600">{items.length}</div>
                                        <div className="text-xs text-gray-500">Total Items</div>
                                    </div>
                                    <div>
                                        <div className="text-2xl font-bold text-green-600">
                                            {items.filter(i => getDaysInFreezer(i.dateAdded) <= 30).length}
                                        </div>
                                        <div className="text-xs text-gray-500">Fresh Items</div>
                                    </div>
                                    <div>
                                        <div className="text-2xl font-bold text-orange-600">
                                            {items.filter(i => getDaysInFreezer(i.dateAdded) > 60).length}
                                        </div>
                                        <div className="text-xs text-gray-500">Getting Old</div>
                                    </div>
                                    <div>
                                        <div className="text-2xl font-bold text-purple-600">
                                            {topContributor || '-'}
                                        </div>
                                        <div className="text-xs text-gray-500">Top Contributor</div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FreezerTracker />);
    </script>
</body>
</html>
